---
title: 使用 React 开发邮件模板
date: 2024-04-24 21:36:29
categories: ["实践总结"]
tags: ["前端", "React"]
thumbnail: /gallery/thumbnails/email.png
---
刚来土澳的时候很不习惯什么都要查邮件，在国内很多都是手机短信通知或者应用内通知，待久了也习惯了每天查看下邮箱。现在这家公司很多运营都是发邮件，一些关键用户通知，还有营销都是发邮件。我们使用 Orrto 作为营销工具，这个工具可能很少人听说，举个场景：用户在我们网站上进行了一些操作，填了邮箱信息，那我们就可以跟进这个潜在用户，我们会在 Ortto 中创建一个 Journey 这个潜在用户进入这个 Journey 之后会发送一些邮件给他，可能会间隔几天发送另外一封，当然如果这个潜在用户在此过程中完成了相应订单，我们就要从这个 Journey 中移除。总的来说，有很多的场景我们需要给客户发送各种各样的邮件。
## 邮件开发中的问题
一般来说，相比较常见前端页面，邮件更像是一个运营的页面，很少内容交互，更多的是作为一个入口。或者说基本就是一个静态页面，写写 HTML 和 CSS 事，事倒是简单，但是要适配各种邮件客户端就麻烦了，很多客户端对 HTML 的支持还不如 IE6，事实是就算只支持各个主流的最新的客户端，也不能用 div + css，而必须用 table。
我们最开始的时候就是维护了一些常见的模板，每次有新邮件需求时，都是通过复制粘贴的方式搞定，只要不是新的布局还是很快就能搞定的。只是后来模板越来越多，设计也倾向于整点新活，维护起来也感觉越来越麻烦。
## 解决方案
### React Email
我们最开始有考虑开源的 react-email 当时还是 beta 版本因为各种原因没有采用，不过很大程度上是相同的思路。个人的话下一次肯定考虑使用开源的 react-email。我们也根据设计稿，配置了不同的主题，开发了常用的组件，尤其是特殊布局的。最主要的是我们的邮件需要支持不同的模板引擎，一般组件不用感知到模板差异，所以我们添加了一些这样的组件来屏蔽下层的实现细节。
```jsx
<If condition="expression"> 
  <If.True>[...components to show when condition true]</If.True>
  <If.IfElse condition="alternate expression">[...components to show when alternate condition true]</If.IfElse>
  <If.False>[...components to show when condition false (optional)]</If.False>
</If>
```

本地开发使用 Storybook，预览的时候会有数据填充，而非预览最终模板。
### 特性支持
如果在开发中，不确定某个特性是否兼容，可以在 caniemail 上查看， 与 caniuse 类似。要注意的是这个网站给的也并不完全可靠，最终结果还是在实际平台上测试，我们使用的是 Litmus 预览在各个邮件客户端上的效果。实际当中会有很多的坑，比如并不是所有的元素都支持 padding；widht:100% 不生效，只能一个一个针对性的处理。
### 主题支持
各个客户端对 dark 模式支持不尽相同，各有各的规则，并不完全受控制。当时是只有 Apple Mail 较好的支持 Media Query，其它客户端有它们自己的规则来反转颜色。最终我们基本放弃了在这上面的适配，不过还是要求所有的图片必须有背景。
## 最后
邮件开发的需求还是非常常见的，不知道为什么像 `react-emails` 这样的工具很晚才出现，相关的文章也很少见到。  
